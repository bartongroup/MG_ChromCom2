---
title: "Fitting new data"
author:
  - name: Marek Gierlinski
    affiliations: Data Analysis Group
    note: "Creator of this report"
date: today
date-format: "D MMMM YYYY"
execute:
  echo: false
  cache: false
  warning: false
format:
  html:
    theme:
      - journal
      - report.scss
    toc: true
self-contained: true
---


```{r}
suppressPackageStartupMessages({
  library(tidyverse)
  #library(gridExtra)
  library(ChromComFit)
})
source("../R/bootstraps.R")
```

# Introduction

We are looking at data collected recently and processed using [Shiny app](https://shiny.compbio.dundee.ac.uk/private/marek_chromcom2/parsing_states/). Parsing parameters are as follows:

 - Black/blue limit 0 (effectively switched off)
 - Black length 5 (effectively switched off by above parameter)
 - Blue/Brown limit 0.75
 - Brown/red-pink limit 0.2
 - Red/Pink limit 0.4
 - Red/Pink angle 45
 - Red-pink rule: a<D & b<D | ang< A & (a<D | b<D)

Here we look at two data sets, TT204-Thy_NCAPD2 and TT234-Thy_NCAPD2.

# Data

```{r}
sets <- c("TT204-Thy_NCAPD2", "TT234-Thy_NCAPD2")
parstr <- "tau1_k1_k2_tau2"
```


```{r}
fits <- map(sets, function(s) {
  f <- file.path("..", "fits", str_glue("fits_{s}_{parstr}.rds"))
  read_rds(f)
}) |> 
  set_names(sets)


boots <- readBootstraps(sets, "../bootstraps", root = "boot", nboot = 300, halflife = TRUE)
```


```{r}
#| label: fig-timelines-1
#| fig-cap: Proportion of cells in three states for TT204-Thy_NCAPD2. Thin lines represent experimental data, thick lines represent the best-fitting model.
plot_timelines(fits$`TT204-Thy_NCAPD2`$fit, expdata = fits$`TT204-Thy_NCAPD2`$echr, smooth = TRUE, k = 3, withpars = TRUE)
```

```{r}
#| label: fig-timelines-2
#| fig-cap: Proportion of cells in three states for TT234-Thy_NCAPD2. Thin lines represent experimental data, thick lines represent the best-fitting model.
plot_timelines(fits$`TT234-Thy_NCAPD2`$fit, expdata = fits$`TT234-Thy_NCAPD2`$echr, smooth = TRUE, k = 3, withpars = TRUE)
```

# Bootstraps

```{r}
#| label: fig-pardist
#| fig-cap: Distribution of fit parameters from a bootstrap.
plotBootstrapDistributions(boots)
```


```{r}
#| label: fig-parcor
#| fig-cap: There is a correlation between k2 and half-life 2. Therefore, parameter errors might be inflated.
plotBootstrapParamCor(boots)
```


```{r}
#| label: fig-parci
#| fig-cap: 95% confidence intervals from a bootstrap. Some of the parameters are poorely constrained.
plotBootstrapCI(boots)
```

